;
(self.AMP=self.AMP||[]).push({m:0,v:"2205120110001",n:"amp-link-rewriter",ev:"0.1",l:!0,f:function(n,t){!function(){function t(n,r){return(t=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,r)}function r(n){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function e(n){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function i(n,t){if(t&&("object"===e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}Array.isArray;var u,o=Object.prototype,c=o.hasOwnProperty;function f(n,t){return c.call(n,t)}function s(n,t){return n.replace(/^|,/g,"$&".concat(t," "))}o.toString,self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var a=self.__AMP_LOG;function h(n){return a.user||(a.user=l()),function(n,t){return t&&t.ownerDocument.defaultView!=n}(a.user.win,n)?a.userForEmbed||(a.userForEmbed=l()):a.user}function l(n){return function(n,t){throw new Error("failed to call initLogConstructor")}()}function v(n,t,r,e,i,u,o,c,f,s,a){return n}function d(n,t){return b(y(p(n)),t)}function p(n){return n.nodeType?(r=n,t=(r.ownerDocument||r).defaultView,function(n,t){return b(n=function(n){return n.__AMP_TOP||(n.__AMP_TOP=n)}(n),"ampdoc")}(t)).getAmpDoc(n):n;var t,r}function y(n){var t=p(n);return t.isSingleDoc()?t.win:t}function b(n,t){v(w(n,t));var r=function(n){var t=n.__AMP_SERVICES;return t||(t=n.__AMP_SERVICES={}),t}(n)[t];return r.obj||(v(r.ctor),v(r.context),r.obj=new r.ctor(r.context),v(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function w(n,t){var r=n.__AMP_SERVICES&&n.__AMP_SERVICES[t];return!(!r||!r.ctor)}var m=function(n){return d(n,"documentInfo").get()},E=(new Set(["c","v","a","ad"]),0);function O(n){var t,r,e,i,o=function(n){try{return function(n){var t,r,e,i,o=(t=n,/^[\w-]+$/.test(r="script"),e=t,i="> ".concat(r),(void 0!==u?u:u=function(n){try{var t=n.ownerDocument,r=t.createElement("div"),e=t.createElement("div");return r.appendChild(e),r.querySelector(":scope div")===e}catch(n){return!1}}(e))?e.querySelectorAll(s(i,":scope")):function(n,t){var r=n.classList,e="i-amphtml-scoped";r.add(e);var i=s(t,".".concat(e)),u=n.querySelectorAll(i);return r.remove(e),u}(e,i)),c=o.length;if(1!==c)throw new Error("Found ".concat(c," <script> children. Expected 1."));var f,a=o[0];if(!function(n){var t;return"SCRIPT"==n.tagName&&"APPLICATION/JSON"==(null===(t=n.getAttribute("type"))||void 0===t?void 0:t.toUpperCase())}(a))throw new Error('<script> child must have type="application/json"');try{var h;return f=null!==(h=a.textContent)&&void 0!==h?h:"",JSON.parse(f)}catch(n){throw new Error("Failed to parse <script> contents. Is it valid JSON?")}}(n)}catch(t){throw h(n).createError("%s: %s","amp-link-rewriter",t)}}(n);return i=o.output,"amp-link-rewriter: output config property is required",h().assert(i,"amp-link-rewriter: output config property is required",undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined),{output:o.output.toString(),section:f(o,"section")?o.section:[],attribute:f(o,"attribute")?(r=o.attribute,e={},Object.keys(r).forEach((function(n){e[n]="^"+r[n]+"$"})),e):{},vars:f(o,"vars")?o.vars:{},scopeDocument:null===(t=o.scopeDocument)||void 0===t||t}}function R(n,t){var r=t.attribute;return Object.keys(r).every((function(t){return new RegExp(r[t]).test(n.getAttribute(t))}))}var j=["href","id","rel","rev"],S=/^vars(.+)/,g=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,C={"SOURCE_URL":!0,"DOCUMENT_REFERRER":!0,"AMP_GEO":!0},I=function(){function n(n,t,r){var e,i;this.$E=r,this.KE=O(t),this.QE=function(n,t){var r=n.getRootNode(),e=t.section.join(" a, "),i=r.querySelectorAll("a"),u=[];return 0!==t.section.length&&(e+=" a",i=r.querySelectorAll(e)),i.forEach((function(n){R(n,t)&&u.push(n)})),u}(this.$E,this.KE),this.XE=n,this.NR="",this.UR=(e="url-replace",w(i=y(p(t)),e)?b(i,e):null)}var t=n.prototype;return t.handleClick=function(n){if(n&&(this.NR=this.KE.output,!this.$R(n)&&this.MR(n))){var t=m(this.$E).sourceUrl.match(g)[1],r=m(this.$E).canonicalUrl.match(g)[1];this._R(n,[t,r])||this.JR(n)}},t.$R=function(n){return n.href.match(g)[1]===this.NR.match(g)[1]},t.MR=function(n){return this.KE.scopeDocument?this.LR(n):!!R(t=n,r=this.KE)&&function(n,t){return 0===t.section.length||(r=n,e=t.section.join(","),!!(r.closest?r.closest(e):function(n,t,r){var e;for(e=n;e&&void 0!==e;e=e.parentElement)if(t(e))return e;return null}(r,(function(n){return function(n,t){var r=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;return!!r&&r.call(n,t)}(n,e)}))));var r,e}(t,r);var t,r},t.LR=function(n){return null===this.QE||0===this.QE.length||this.QE.filter((function(t){return t===n})).length>0},t._R=function(n,t){var r=n.href;return t.some((function(n){var t=r.match(g);return!t||g.test(r)&&t[1]===n}))},t.JR=function(n){this.NR=this.GR();var t=this.KE.vars;t instanceof Object&&(n.href=this.ZR(n,t))},t.GR=function(){return this.UR.expandUrlSync(this.NR,{DOCUMENT_REFERRER:this.XE},C)},t.ZR=function(n,t){var r=this;j.forEach((function(r){n.getAttribute(r)&&(t[r]=n.getAttribute(r))}));var e=function(n,t,r){var e=n.dataset,i={},u=r;for(var o in e){var c=o.match(u);c&&(i[c[1][0].toLowerCase()+c[1].substr(1)]=e[o])}return i}(n,0,S);return Object.assign(t,e),t.random=Math.random().toString(32).substr(2),Object.keys(t).forEach((function(n){t[n]&&(r.NR=r.NR.replace("${"+n+"}",encodeURIComponent(t[n])))})),this.NR=this.NR.replace(/\${[A-Za-z0-9]+}+/,(function(){return""})),this.NR},n}(),N=function(n){!function(n,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&t(n,r)}(c,n);var e,u,o=(e=c,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}(),function(){var n,t=r(e);if(u){var o=r(this).constructor;n=Reflect.construct(t,arguments,o)}else n=t.apply(this,arguments);return i(this,n)});function c(n){var t;return(t=o.call(this,n)).HR=null,t.XE="",t}var f=c.prototype;return f.buildCallback=function(){var n=this,t=d(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then((function(){return t.getReferrerUrl()})).then((function(t){return n.XE=t})).then(this.KR.bind(this))},f.KR=function(){this.HR=new I(this.XE,this.element,this.getAmpDoc()),this.QR()},f.QR=function(){var n,t=this;return(n=this.getAmpDoc(),d(n,"navigation")).registerAnchorMutator((function(n){t.HR.handleClick(n)}),E),!0},f.isLayoutSupported=function(n){return"nodisplay"===n},c}(n.BaseElement);n.registerElement("amp-link-rewriter",N)}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-link-rewriter-0.1.js.map