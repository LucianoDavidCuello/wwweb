;
(self.AMP=self.AMP||[]).push({m:0,v:"2205120110001",n:"amp-vk",ev:"0.1",l:!0,f:function(t,n){!function(){function n(t,r){return(n=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,r)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}var o=Array.isArray,u=Object.prototype;u.hasOwnProperty,u.toString,self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var s=self.__AMP_LOG;function f(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function l(t,n,r,e,i,o,u,s,f,l,a){return t}function a(t,n,r,e,i,o,u,l,a,c,h){return(s.user||(s.user=f()),void s.user.win?s.userForEmbed||(s.userForEmbed=f()):s.user).assert(t,n,r,e,i,o,u,l,a,c,h)}function c(t,n){return p(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}function h(t){return t.nodeType?(r=t,n=(r.ownerDocument||r).defaultView,c(n,"ampdoc")).getAmpDoc(t):t;var n,r}function p(t,n){l(function(t,n){var r=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!r||!r.ctor)}(t,n));var r=function(t){var n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}(t)[n];return r.obj||(l(r.ctor),l(r.context),r.obj=new r.ctor(r.context),l(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}var d,v=function(t){return function(t,n){return p((r=h(t),(e=h(r)).isSingleDoc()?e.win:e),n);var r,e}(t,"viewer")};function m(t,n,r){if(!n)return t;var e=t.split("#",2),i=e[0].split("?",2);return i[0]+(i[1]?r?"?".concat(n,"&").concat(i[1]):"?".concat(i[1],"&").concat(n):"?".concat(n))+(e[1]?"#".concat(e[1]):"")}function b(t,n){return m(t,function(t){var n,r,e,i=[];for(var u in t){var s=t[u];if(null!=s){s=o(e=s)?e:[e];for(var f=0;f<s.length;f++)i.push((n=u,r=s[f],"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r))))}}return i.join("&")}(n))}new Set(["c","v","a","ad"]);var y="post",w="poll",k=function(t){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&n(t,r)}(s,t);var e,o,u=(e=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=r(e);if(o){var u=r(this).constructor;t=Reflect.construct(n,arguments,u)}else t=n.apply(this,arguments);return i(this,t)});function s(t){var n;return(n=u.call(this,t)).tb=null,n.tP=0,n.Bb=null,n.Nv=null,n.nP=null,n.rP=null,n.eP=null,n.iP=null,n.oP=null,n}var f=s.prototype;return f.preconnectCallback=function(t){var n;(n=this.win,c(n,"preconnect")).url(this.getAmpDoc(),"https://vk.com",t)},f.uP=function(){var t,n=Date.now().toString(16);return this.Nv===y?t=this.sP():this.Nv===w&&(t=this.fP()),t.then((function(t){return m(t,n)}))},f.sP=function(){var t=this;return v(this.element).getReferrerUrl().then((function(n){var r=t.element.offsetWidth,e=t.getAmpDoc().getUrl();return b("https://vk.com/widget_post.php",{"app":"0","width":"100%","_ver":"1","owner_id":t.nP,"post_id":t.rP,"hash":t.eP,"amp":"1","startWidth":r,"url":e,"referrer":n,"title":"AMP Post"})}))},f.fP=function(){var t=this;return v(this.element).getReferrerUrl().then((function(n){var r=t.getAmpDoc().getUrl();return b("https://vk.com/al_widget_poll.php",{"app":t.iP,"width":"100%","_ver":"1","poll_id":t.oP,"amp":"1","url":r,"title":"AMP Poll","description":"","referrer":n})}))},f.buildCallback=function(){var t;this.Nv=a(this.element.getAttribute("data-embedtype"),"The data-embedtype attribute is required for <amp-vk> %s",this.element),a("post"===(t=this.Nv)||"poll"===t,"Unknown data-embedtype: ".concat(this.Nv)),this.Nv===y?this.lP():this.Nv===w&&this.aP()},f.lP=function(){this.nP=a(this.element.getAttribute("data-owner-id"),"The data-owner-id attribute is required for <amp-vk> Post %s",this.element),this.rP=a(this.element.getAttribute("data-post-id"),"The data-post-id attribute is required for <amp-vk> Post %s",this.element),this.eP=a(this.element.getAttribute("data-hash"),"The data-hash attribute is required for <amp-vk> Post %s",this.element)},f.aP=function(){this.iP=a(this.element.getAttribute("data-api-id"),"The data-api-id attribute is required for <amp-vk> Poll %s",this.element),this.oP=a(this.element.getAttribute("data-poll-id"),"The data-poll-id attribute is required for <amp-vk> Poll %s",this.element)},f.layoutCallback=function(){var t,n,r,e,i,o,u,s,f=this,l=this.element.ownerDocument.createElement("iframe");return this.tb=l,this.Bb=(t=this.win,n="message",r=this.cP.bind(this),e=void 0,i=t,o=r,u=function(t){try{return o(t)}catch(t){var n,r;throw null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,t),t}},s=function(){if(void 0!==d)return d;d=!1;try{var t={get capture(){return d=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return d}(),i.addEventListener(n,u,!!s&&e),function(){null==i||i.removeEventListener(n,u,!!s&&e),o=null,i=null,u=null}),this.uP().then((function(t){return l.src=t,l.setAttribute("name","fXD"),l.setAttribute("scrolling","no"),l.setAttribute("frameborder","0"),l.setAttribute("allowfullscreen","true"),function(t,n){t.classList.add("i-amphtml-fill-content")}(l),f.element.appendChild(l),f.loadPromise(l)}))},f.cP=function(t){if("https://vk.com"===t.origin&&t.source===this.tb.contentWindow){var n=t.data;if(n){var r=/\[\"resize",\[(\d+)\]]/.exec(n);if(r&&r[1]){var e=parseInt(r[1],10);this.tP!==e&&(this.tP=e,this.forceChangeHeight(e))}}}},f.isLayoutSupported=function(t){return"responsive"===t||"flex-item"===t||"fixed"===t},f.unlayoutOnPause=function(){return!0},f.unlayoutCallback=function(){var t,n;return this.tb&&(null===(n=(t=this.tb).parentElement)||void 0===n||n.removeChild(t),this.tb=null),this.Bb&&this.Bb(),!0},s}(t.BaseElement);t.registerElement("amp-vk",k)}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-vk-0.1.js.map