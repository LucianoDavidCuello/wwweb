;
(self.AMP=self.AMP||[]).push({m:1,v:"2205120110001",n:"amp-story-panning-media",ev:"0.1",l:!0,f:function(t,i){(()=>{var{isArray:i}=Array,{hasOwnProperty:n,toString:e}=Object.prototype;function s(t,i,n,e,s,r,o,a,u,h,c){return t}var r,o=class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},a=["Webkit","webkit","Moz","moz","ms","O","o"];function u(t){const i=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return a.some((t=>i.startsWith(t+"-")))?`-${i}`:i}function h(t,i,n){if(i.startsWith("--"))return i;r||(r=Object.create(null));let e=r[i];if(!e||n){if(e=i,void 0===t[i]){const n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(i),s=function(t,i){for(let n=0;n<a.length;n++){const e=a[n]+i;if(void 0!==t[e])return e}return""}(t,n);void 0!==t[s]&&(e=s)}n||(r[i]=e)}return e}function c(t,i){const{style:n}=t;for(const t in i)n.setProperty(u(h(n,t)),String(i[t]),"important")}function l(t){if(!t)return null;const i=t.match(/^(.*)\/(.*)-([0-9.]+|latest)(\.max)?\.(?:js|mjs)$/i),n=i?i[2]:void 0,e=i?i[3]:void 0;return n&&e?{extensionId:n,extensionVersion:e}:null}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var f=self.__AMP_LOG;function m(t){return f.user||(f.user=p()),function(t,i){return i&&i.ownerDocument.defaultView!=t}(f.user.win,t)?f.userForEmbed||(f.userForEmbed=p()):f.user}function p(t){return function(t,i){throw new Error("failed to call initLogConstructor")}()}function d(t,i,n,e,s,r,o,a,u,h,c){return t}function g(t,i){return y(t,i)}function P(t,i){d(function(t,i){const n=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!n||!n.ctor)}(t,i));const n=A(t)[i];return n.obj||(d(n.ctor),d(n.context),n.obj=new n.ctor(n.context),d(n.obj),n.context=null,n.resolve&&n.resolve(n.obj)),n.obj}function y(t,i){const n=A(t)[i];return n?n.promise?n.promise:(P(t,i),n.promise=Promise.resolve(n.obj)):null}function A(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}var _="AMP_STORY_PANNING_MEDIA",b=class extends t.BaseElement{constructor(t){super(t),this.wV=null,this.TV={},this.VV=null,this.jV={},this.zV=null,this.FV=null,this.OV=!1,this.SV=null,this.CV=null}buildCallback(){return(t=this.win,function(t,i,n,e,s){return g(t,i)||function(t,i,n,e,s){return(r=t.document,new Promise((t=>function(t,i){!function(t,i,n){var e;if(i())n();else{const s=new(e=t,(e.ownerDocument||e).defaultView).MutationObserver((()=>{i()&&(s.disconnect(),n())}));s.observe(t,{childList:!0})}}(t.documentElement,(()=>!!t.body),i)}(r,t)))).then((()=>{const i=function(t,i){return P(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),"extensions")}(t);return function(t,i,n){return function(t){if(!t)return[];const i=t.querySelectorAll("script[custom-element],script[custom-template]"),n=[];for(let t=0;t<i.length;t++){const e=i[t],s=e.getAttribute("custom-element")||e.getAttribute("custom-template"),r=l(e.src);s&&r&&n.push({script:e,extensionId:s,extensionVersion:r.extensionVersion})}return n}(t.document.head).some((({extensionId:t,extensionVersion:e})=>i==t&&n==e))}(i.win,n,e)?i.waitForExtension(n,e):null})).then((n=>n?s?g(t,i):function(t,i){return function(t,i){const n=y(t,i);if(n)return n;const e=A(t);return e[i]=function(){const t=new o,{promise:i,reject:n,resolve:e}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:e,reject:n,context:null,ctor:null}}(),e[i].promise}(t,i)}(t,i):null));var r}(t,i,n,e,s)}(t,"story-store","amp-story","1.0")).then((t=>this.zV=t));var t}layoutCallback(){return this.wV=this.element.querySelector("amp-img"),this.CV=this.element.getAttribute("group-id")||this.wV.getAttribute("src"),this.DV(),function(t){if(s(function(t){const i=t.tagName;return i.startsWith("AMP-")&&!("AMP-STICKY-AD-TOP-PADDING"==i||"AMP-BODY"==i)}(t)),t.createdCallback)return Promise.resolve(t);if(!t.__AMP_UPG_PRM){const i=new o;t.__AMP_UPG_PRM=i.promise,t.__AMP_UPG_RES=i.resolve}const i=t.__AMP_UPG_PRM;return s(i),i}(this.wV).then((()=>this.wV.signals().whenSignal("load-end"))).then((()=>{this.element.querySelector("img").classList="",this.LV()})).catch((()=>m().error(_,"Failed to load the amp-img.")))}DV(){this.zV.subscribe(41,(()=>{this.VV={width:this.element.offsetWidth,height:this.element.offsetHeight},this.LV(),this.$V(),this.NV()}),!0),this.zV.subscribe(35,(t=>{this.OV=t===this.qV(),this.NV()}),!0),this.zV.subscribe(23,(t=>this.YV(t)),!0);const t=new MutationObserver((t=>this.SV=parseInt(t[0].target.getAttribute("distance"),10)));this.BV()&&t.observe(this.BV(),{attributes:!0,attributeFilter:["distance"]})}$V(){const t=parseFloat(this.element.getAttribute("data-x")||0),i=parseFloat(this.element.getAttribute("data-y")||0),n=parseFloat(this.element.getAttribute("data-zoom")||1);if(this.element.hasAttribute("lock-bounds")){this.TV.zoom=n<1?1:n;const{horizontal:e,vertical:s}=this.GV();this.TV.x=Math.max(-e,Math.min(t,e)),this.TV.y=Math.max(-s,Math.min(i,s))}else this.TV={x:t,y:i,zoom:n}}GV(){const{height:t,width:i}=this.VV,n=this.wV.getAttribute("width"),e=this.wV.getAttribute("height");n&&e||m().error(_,'"lock-bounds" requires "width" and "height" to be set on the amp-img child.');const s=i/t<n/e?t/e:i/n,r=s*e;return{horizontal:50*(1-i/(s*n*this.TV.zoom)),vertical:50*(1-t/(r*this.TV.zoom))}}NV(){if(!this.OV)return;const t=this.zV.get(23)[this.CV];if(!t||null!==(i=this.win.matchMedia("(prefers-reduced-motion: reduce)"))&&void 0!==i&&i.matches)return void this.zV.dispatch(3,{[this.CV]:this.TV});var i;let n;const e=i=>{n||(n=i);const s=i-n;if(s<1e3){const{x:i,y:n,zoom:o}=this.TV,a=(r=s/1e3)<.5?2*r*r:1-Math.pow(-2*r+2,2)/2;this.zV.dispatch(3,{[this.CV]:{x:t.x+(i-t.x)*a,y:t.y+(n-t.y)*a,zoom:t.zoom+(o-t.zoom)*a}}),this.OV&&requestAnimationFrame(e)}else this.zV.dispatch(3,{[this.CV]:this.TV});var r};requestAnimationFrame(e)}LV(){const t=this.element.querySelector("img");if(!t)return;const{height:i,width:n}=this.VV,e=n/i,s=this.wV.getAttribute("width")/this.wV.getAttribute("height");this.mutateElement((()=>{e<s?(c(this.wV,{left:"auto",right:"auto",top:"0",bottom:"0",width:"auto",height:"100%"}),c(t,{width:"auto",height:"100%"})):(c(this.wV,{left:"0",right:"0",top:"auto",bottom:"auto",width:"100%",height:"auto"}),c(t,{width:"100%",height:"auto"}))}))}YV(t){this.SV<=1&&t[this.CV]&&!function(t,n,e=5){if(!isFinite(e)||e<0)throw new Error("Invalid depth: "+e);if(t===n)return!0;const s=[{a:t,b:n,depth:e}];for(;s.length>0;){const{a:t,b:n,depth:e}=s.shift();if(e>0){if(typeof t!=typeof n)return!1;if(i(t)&&i(n)){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)s.push({a:t[i],b:n[i],depth:e-1});continue}if(t&&n&&"object"==typeof t&&"object"==typeof n){const i=Object.keys(t),r=Object.keys(n);if(i.length!==r.length)return!1;for(const r of i)s.push({a:t[r],b:n[r],depth:e-1});continue}}if(t!==n)return!1}return!0}(this.jV,t[this.CV])&&(this.jV=t[this.CV],this.ZV())}ZV(){const{x:t,y:i,zoom:n}=this.jV;return this.mutateElement((()=>{c(this.wV,{transform:`translate3d(${t}%, ${i}%, ${this.KV(n)}px)`})}))}KV(t){const i=(t-1)/t;return isFinite(i)?i:-1e5}qV(){return null==this.FV&&(this.FV=this.BV().getAttribute("id")),this.FV}BV(){return function(t,i,n){let e;for(e=t;e&&void 0!==e;e=e.parentElement)if(i(e))return e;return null}(this.element,(t=>"amp-story-page"===t.tagName.toLowerCase()))}isLayoutSupported(t){return"fill"==t}};t.registerElement("amp-story-panning-media",b,"amp-story-panning-media{display:-ms-flexbox!important;display:flex!important;-ms-flex-pack:center!important;justify-content:center!important;-ms-flex-align:center!important;align-items:center!important;perspective:1px!important}amp-story-panning-media amp-img{-webkit-backface-visibility:hidden!important;backface-visibility:hidden!important}amp-story-grid-layer[template=fill] amp-story-panning-media amp-img img{position:relative!important;display:inline-block!important}\n/*# sourceURL=/extensions/amp-story-panning-media/0.1/amp-story-panning-media.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-story-panning-media-0.1.mjs.map