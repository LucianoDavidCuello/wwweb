;
(self.AMP=self.AMP||[]).push({m:1,v:"2205120110001",n:"amp-iframely",ev:"0.1",l:!0,f:function(t,i){(()=>{var i,n,e,{isArray:s}=Array,{hasOwnProperty:r,toString:a}=Object.prototype;function o(t,i,n,e,s,r,a,o,l,u,h){return t}function l(t,i){t.classList.add("i-amphtml-fill-content"),i&&t.classList.add("i-amphtml-replaced-content")}new WeakMap,new WeakMap;var u,h=["Webkit","webkit","Moz","moz","ms","O","o"];self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var c=self.__AMP_LOG;function f(t){return function(t,i){throw new Error("failed to call initLogConstructor")}()}function d(t,i,n,e,s,r,a,o,l,u,h){return(c.user||(c.user=f()),void c.user.win?c.userForEmbed||(c.userForEmbed=f()):c.user).assert(t,i,n,e,s,r,a,o,l,u,h)}function m(t,i){return function(t,i,n){if(!i)return t;const e=t.split("#",2),s=e[0].split("?",2);let r=s[0]+(s[1]?`?${s[1]}&${i}`:`?${i}`);return r+=e[1]?`#${e[1]}`:"",r}(t,function(t){const i=[];for(const a in t){let o=t[a];if(null!=o){o=s(r=o)?r:[r];for(let t=0;t<o.length;t++)i.push((n=a,e=o[t],`${encodeURIComponent(n)}=${encodeURIComponent(e)}`))}}var n,e,r;return i.join("&")}(i))}new Set(["c","v","a","ad"]);var p="amp-iframely",y=class extends t.BaseElement{constructor(t){super(t),this.$y=null,this.eb=null,this.Cy=null,this.Wy=null,this.hi=null,this.zy=null,this.U=null}isLayoutSupported(t){return function(t){return"fixed"==t||"fixed-height"==t||"responsive"==t||"fill"==t||"flex-item"==t||"fluid"==t||"intrinsic"==t}(t)}buildCallback(){this.Cy=this.element.getAttribute("data-id"),this.hi=this.element.getAttribute("data-url"),this.zy=this.element.getAttribute("data-key"),this.U=this.By();let t="cdn.iframe.ly";const i=this.element.getAttribute("data-domain");i&&this.Dy(i)&&(t=i),this.Wy=`https://${t}/`,this.Ly()}preconnectCallback(t){this.preconnect&&this.preconnect.hi&&this.preconnect.url(this.Wy,t)}createPlaceholderCallback(){const t=this.getLayout();if(this.element.hasAttribute("data-img")||"responsive"===t&&!this.element.hasAttribute("resizable")){const t=(i={"src":m(this.Uy("/thumbnail"),this.U),"loading":"lazy","placeholder":""},function(t,i){for(const n in i)t.setAttribute(n,i[n]);return t}(this.element.ownerDocument.createElement("img"),i));return l(t),t}var i;return null}layoutCallback(){return this.eb=this.element.ownerDocument.createElement("iframe"),function(t,i,n,s,r){const a=function(t,i,n){if(i.startsWith("--"))return i;e||(e=Object.create(null));let s=e[i];if(!s||n){if(s=i,void 0===t[i]){const n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(i),e=function(t,i){for(let n=0;n<h.length;n++){const e=h[n]+i;if(void 0!==t[e])return e}return""}(t,n);void 0!==t[e]&&(s=e)}n||(e[i]=s)}return s}(t.style,i,r);if(!a)return;const o=s?n+s:n;t.style.setProperty(function(t){const i=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return h.some((t=>i.startsWith(t+"-")))?`-${i}`:i}(a),o)}(this.eb,"border","0px"),this.eb.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-presentation"),this.$y=m(this.$y,this.U),this.eb.src=this.$y,l(this.eb),this.element.appendChild(this.eb),this.qy=function(t,i,n,e){let s=t,r=n,a=t=>{try{return r(t)}catch(t){var i,n;throw null===(i=(n=self).__AMP_REPORT_ERROR)||void 0===i||i.call(n,t),t}};const o=function(){if(void 0!==u)return u;u=!1;try{const t={get capture(){return u=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return u}();return s.addEventListener(i,a,!!o&&e),()=>{null==s||s.removeEventListener(i,a,!!o&&e),r=null,s=null,a=null}}(this.win,"message",(t=>{t.source===this.eb.contentWindow&&this.Fy(t)}),void 0),this.loadPromise(this.eb)}Fy(t){const e=function(t,i){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null}}(function(t){return t.data}(t));if(e){if("resize"===e.method&&e.height>50)this.attemptChangeHeight(e.height).catch((()=>{}));else if("setIframelyEmbedData"===e.method){const t=e.data.media||null;t&&t["aspect-ratio"]&&function(t){var e;let s=null===(e=i)||void 0===e?void 0:e.get(t);if(!s){const e=function(t){i||(i=new WeakMap,n=new WeakMap),o(n);let e=n.get(t);return e||(e=function(t,i,n={}){const{needsRootBounds:e,rootMargin:s,threshold:r}=n,a=function(t){return t.parent&&t.parent!=t}(i)&&(e||s)?i.document:void 0;return new i.IntersectionObserver(t,{threshold:r,root:a,rootMargin:s})}((t=>{const n=new Set;for(let r=t.length-1;r>=0;r--){var s;const{target:a}=t[r];n.has(a)||(n.add(a),o(e),e.unobserve(a),o(i),null===(s=i.get(a))||void 0===s||s.resolve(t[r]),i.delete(a))}}),t,{needsRootBounds:!0}),n.set(t,e)),e}(((r=t).ownerDocument||r).defaultView);o(i),e.observe(t),s=new class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},i.set(t,s)}var r;return s.promise}(this.element).then((i=>{if(t["padding-bottom"]){const n=i.boundingClientRect.width/t["aspect-ratio"]+t["padding-bottom"];this.attemptChangeHeight(Math.round(n)).catch((()=>{}))}else{const n=i.boundingClientRect.width/t["aspect-ratio"];Math.abs(i.boundingClientRect.height-n)>1&&this.attemptChangeHeight(Math.round(n)).catch((()=>{}))}}))}"cancelWidget"===e.method&&this.attemptCollapse().catch((()=>{}))}}Uy(t){return this.Cy?`${this.Wy}${this.Cy}${"/iframe"!==t?t:""}?amp=1`:m(`${this.Wy}api${t}`,{"url":this.hi,"key":this.zy,"amp":"1"})}Ly(){d(this.element.getAttribute("data-id")||this.element.getAttribute("data-url"),'<%s> requires either "data-id" or a pair of "data-url" and "data-key" attributes for %s',p,this.element),this.Cy||(this.hi&&d(this.zy,"Iframely data-key must also be set when you specify data-url parameter at <%s> %s",p,this.element),this.zy&&d(this.hi,"Iframely data-url must also be set when you specify data-key parameter at <%s> %s",p,this.element),(this.zy||this.hi)&&d(!this.Cy,"Iframely data-id should not be set when there is already a pair of data-url and data-key for <%s> %s",p,this.element)),(this.Cy&&this.hi||this.Cy&&this.zy)&&d(!this.Cy,"Only one way of setting either data-id or data-url and data-key supported for <%s> %s",p,this.element),this.$y=this.Uy("/iframe")}By(){return t=this.element.dataset,i=["id","domain","key","url","img"],Object.keys(t).reduce(((n,e)=>(i.includes(e)||(n[e]=t[e]),n)),{});var t,i}unlayoutCallback(){var t,i;return this.eb&&(null===(i=(t=this.eb).parentElement)||void 0===i||i.removeChild(t),this.eb=null),this.Mb&&(this.Mb(),this.Mb=null),!0}Dy(t){return[/^(?:[^\.\/]+\.)?iframe\.ly$/i,/^if\-cdn\.com$/i,/^iframely\.net$/i,/^oembed\.vice\.com$/i,/^iframe\.nbcnews\.com$/i].reduce(((i,n)=>i||n.test(t)),!1)}};t.registerElement(p,y)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-iframely-0.1.mjs.map