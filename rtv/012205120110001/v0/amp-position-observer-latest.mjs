;
(self.AMP=self.AMP||[]).push({m:1,v:"2205120110001",n:"amp-position-observer",ev:"0.1",l:!0,f:function(t,i){(()=>{function i(t,i){const s=[];let n=0;for(let h=0;h<t.length;h++){const e=t[h];i(e,h,t)?s.push(e):(n<h&&(t[n]=e),n++)}return n<t.length&&(t.length=n),s}var{hasOwnProperty:s,toString:n}=Object.prototype;function h(t){return 1==(null==(i=t)?void 0:i.nodeType)?(t=t).tagName.toLowerCase()+(t.id?`#${t.id}`:""):t;var i}function e(t,s,n,e,r,o,l,u,c,a,f){return function(t,s,n="Assertion failed",e){var r,o;if(s)return s;t&&-1==n.indexOf(t)&&(n+=t);let l=3;const u=n.split("%s");let c=u.shift();const a=[c];for(;u.length;){const t=arguments[l++],i=u.shift();c+=h(t)+i,a.push(t,i.trim())}const f=new Error(c);throw f.messageArray=i(a,(t=>""!==t)),null===(r=(o=self).__AMP_REPORT_ERROR)||void 0===r||r.call(o,f),f}("​​​",t,s,n,e,r,o,l,u,c,a,f)}function r(t){return e(/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(null!=t?t:""),"Invalid length value: %s",t),t}var o="inside",l="bottom";function u(t,i,s,n){return{left:t,top:i,width:s,height:n,bottom:i+n,right:t+s,x:t,y:i}}function c(t,i){return t.top<i.top?"top":t.bottom>i.bottom?l:o}function a(t,i){return!(!t||!i)&&t.left==i.left&&t.top==i.top&&t.width==i.width&&t.height==i.height}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var f=self.__AMP_LOG;function _(t,i){throw new Error("failed to call initLogConstructor")}function v(t){return f.user||(f.user=P()),function(t,i){return i&&i.ownerDocument.defaultView!=t}(f.user.win,t)?f.userForEmbed||(f.userForEmbed=P()):f.user}function P(t){return _()}function A(t,i,s,n,h,e,r,o,l,u,c){return t}function d(t,i,s,n,h,e,r,o,l,u,c){return v().assert(t,i,s,n,h,e,r,o,l,u,c)}function p(t,i){return M(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function m(t,i){return M(E(R(t)),i)}function R(t){return t.nodeType?(s=t,i=(s.ownerDocument||s).defaultView,p(i,"ampdoc")).getAmpDoc(t):t;var i,s}function E(t){const i=R(t);return i.isSingleDoc()?i.win:i}function M(t,i){A(I(t,i));const s=b(t)[i];return s.obj||(A(s.ctor),A(s.context),s.obj=new s.ctor(s.context),A(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function b(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}function I(t,i){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!s||!s.ctor)}var V=t=>m(t,"viewport");function T(t){!function(t,i,s,n){const h=R(t),e=E(h);!function(t,i,s,n,h,e){const r=b(t);let o=r[s];o||(o=r[s]={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null,sharedInstance:!1}),o.ctor||(o.ctor=n,o.context=i,o.sharedInstance=!1,o.resolve&&M(t,s))}(e,h,i,class{constructor(t){this.Ni=t,this.i=t.win,this.tR=[],this.ar=p(this.i,"vsync"),this.Uu=V(t),this.F_=[],this.iR=!1,this.sR=!1,this.nR=!1,this.hR=function(t,i,s){let n=0,h=0,e=null;function r(){n=0;const o=s-(t.Date.now()-h);var l;o>0?n=t.setTimeout(r,o):(l=e,e=null,i.apply(null,l))}return function(...i){h=t.Date.now(),e=i,n||(n=t.setTimeout(r,s))}}(this.i,(()=>{this.iR=!1}),500)}observe(t,i,s){const n=new class{constructor(t,i,s,n){this.element=i,this.Me=n,this.fidelity=s,this.turn=0==s?Math.floor(4*Math.random()):0,this.eR=null,this.Uu=V(t)}Ee(t){const i=this.eR;if(i&&a(i.positionRect,t.positionRect)&&a(i.viewportRect,t.viewportRect))return;A(t.positionRect);const s=t.positionRect;var n,h;t.relativePos=c(s,t.viewportRect),n=s,h=t.viewportRect,n.top<=h.bottom&&h.top<=n.bottom&&n.left<=h.right&&h.left<=n.right?(this.eR=t,this.Me(t)):this.eR&&(this.eR=null,t.positionRect=null,this.Me(t))}update(t){if(!t){if(0!=this.turn)return void this.turn--;0==this.fidelity&&(this.turn=4)}const i=this.Uu.getSize(),s=u(0,0,i.width,i.height);this.Uu.getClientRectAsync(this.element).then((t=>{this.Ee({positionRect:t,viewportRect:s,relativePos:null})}))}}(this.Ni,t,i,s);return this.tR.push(n),this.nR||this.rR(),n.update(),()=>{for(let t=0;t<this.tR.length;t++)if(this.tR[t]==n)return void this.oR(t)}}unobserve(t){for(let i=0;i<this.tR.length;i++)if(this.tR[i].element==t)return void this.oR(i);(f.dev||(f.dev=_())).error("POSITION_OBSERVER","cannot unobserve unobserved element")}oR(t){this.tR.splice(t,1),0==this.tR.length&&this.lR()}rR(){this.nR=!0,this.F_.push(this.Uu.onScroll((()=>{this.uR()}))),this.F_.push(this.Uu.onResize((()=>{this.cR()})))}lR(){for(this.nR=!1;this.F_.length;)this.F_.pop()()}updateAllEntries(t){for(let i=0;i<this.tR.length;i++)this.tR[i].update(t)}uR(){this.hR(),this.iR=!0,this.sR||this.aR()}cR(){this.updateAllEntries(!0)}aR(){this.updateAllEntries(),this.sR=!0,this.iR?this.ar.measure((()=>{this.aR()})):this.sR=!1}})}(t,"position-observer")}function g(t,i,s,n){const h={detail:s};return Object.assign(h,n),new t.CustomEvent(i,h)}var w="amp-position-observer",x=class extends t.BaseElement{constructor(t){super(t),this.tc=null,this.Mt=null,this.Uu=null,this.rs=!1,this.fR=0,this._R=0,this.vR="0",this.PR="0",this.AR=0,this.dR=0,this.Tt=null,this.pR=null,this.mR=null,this.RR=0,this.ER=0,this.MR=!1,this.bR=!1}buildCallback(){this.getAmpDoc().whenFirstVisible().then(this.Au.bind(this)),this.MR=this.element.hasAttribute("once")}Au(){this.Ly(),this.tc=function(t,i){const s=E(R(t));return I(s,i)?M(s,i):null}(this.element,"action"),this.Uu=V(this.element),this.IR(),this.getAmpDoc().whenReady().then((()=>{const t=this.VR();this.Mt.observe(t,1,this.TR.bind(this))}))}gR(){const t=g(this.win,`${w}.enter`,{});this.tc.trigger(this.element,"enter",t,1)}wR(){const t=g(this.win,`${w}.exit`,{});this.tc.trigger(this.element,"exit",t,1)}xR(){const t=this.Uu.getScrollTop(),i={"start-scroll-offset":t,"end-scroll-offset":t+this.ER,"initial-inview-percent":this.RR},s=g(this.win,`${w}.scroll`,{"percent":this.RR,"positionObserverData":i});this.tc.trigger(this.element,"scroll",s,1)}TR(t){if(this.MR&&this.bR)return;const i=this.rs,s=this.Tt&&this.Tt.height;this.yR(t),this.Tt=t.viewportRect,s!=t.viewportRect.height&&this.OR();const n=this.SR(t.viewportRect),{positionRect:h}=t;let e;h?(e=c(h,n),this.th(h,n,e)):(this.rs=!1,e=t.relativePos),i&&!this.rs&&(this.RR=e==l?0:1,this.xR(),this.wR(),this.bR=!0),!i&&this.rs&&this.gR(),this.rs&&(this.$R(h,n),this.xR())}th(t,i,s){if(s==o)return void(this.rs=!0);const n="top"==s?this.fR:this._R,h=t.height*n;this.rs=s==l?t.top<=i.bottom-h:t.bottom>=i.top+h}$R(t,i){if(!t)return;const s=t.height*this._R+t.height*this.fR,n=i.height+t.height-s,h=Math.abs(t.top-this.AR-(i.height-t.height*this._R));this.RR=h/n,this.ER=n-h}Ly(){const t=this.element.getAttribute("intersection-ratios");if(t){const i=t.trim().split(" ");this.fR=this.FR(i[0]),this._R=this.fR,i[1]&&(this._R=this.FR(i[1]))}const i=this.element.getAttribute("viewport-margins");if(i){const t=i.trim().split(" ");this.vR=t[0],this.PR=this.vR,t[1]&&(this.PR=t[1])}this.pR=this.element.getAttribute("target")}VR(){let t;return t=this.pR?v().assertElement(this.win.document.getElementById(this.pR),"No element found with id:"+this.pR):this.element.parentNode,this.win.document.body===t&&(t=this.win.document.documentElement),t}jR(t){var i;const s=function(t){r(t);const i=/[a-z]+/i.exec(null!=t?t:"");return e(i,"Failed to read units from %s",t),i[0]}(t=r("number"==typeof(i=t)?i+"px":i&&/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(i)?/^\d+(\.\d+)?$/.test(i)?i+"px":i:void 0));let n=function(t){const i=parseFloat(t);return"number"==typeof(s=i)&&isFinite(s)?i:void 0;var s}(t);return n?(d("px"==s||"vh"==s,"Only pixel or vh are valid as units for exclusion margins: "+t),"vh"==s&&(n=n/100*this.Tt.height),n):0}FR(t){const i=parseFloat(t);return d(i>=0&&i<=1,"Ratios must be a decimal between 0 and 1: "+t),i}OR(){A(this.Tt),A(this.PR),A(this.vR),this.AR=this.jR(this.vR),this.dR=this.jR(this.PR)}SR(t){return A(t),u(t.left,t.top+this.AR,t.width,t.height-this.dR-this.AR)}yR(t){this.mR||(this.mR=t.viewportRect.height);const i=this.mR-t.viewportRect.height;let s=0;Math.abs(i)<150?s=i:this.mR=null,t.viewportRect=u(t.viewportRect.left,t.viewportRect.top,t.viewportRect.width,t.viewportRect.height+s)}IR(){this.Mt||(T(this.getAmpDoc()),this.Mt=m(this.element,"position-observer"))}CR(){if(this.Mt){const t=this.VR();this.Mt.unobserve(t),this.Mt=null}}};t.registerElement(w,x)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-position-observer-0.1.mjs.map